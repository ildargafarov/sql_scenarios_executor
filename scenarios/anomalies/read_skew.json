[
    {
        "id": 0,
        "query": "CREATE TABLE IF NOT EXISTS accounts(id integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, client text, amount numeric);TRUNCATE accounts;INSERT INTO accounts VALUES (2, 'bob', 100.00), (3, 'bob', 900.00);SELECT * FROM accounts;",
        "comment": "Инициализация таблиц и данных"
    },
    {
        "id": 0,
        "query": "BEGIN;SHOW transaction_isolation;"
    },
    {
        "id": 0,
        "query": "UPDATE accounts SET amount = amount - 100 WHERE id = 2;",
        "comment": "Начинаем перевод средств с одного счета Боба на другой"
    },
    {
        "id": 1,
        "query": "BEGIN;SHOW transaction_isolation;"
    },
    {
        "id": 1,
        "query": "SELECT amount FROM accounts WHERE id = 2;",
        "comment": "Другая транзакция, начинает считать баланс на всех счетах Боба"
    },
    {
        "id": 0,
        "query": "UPDATE accounts SET amount = amount + 100 WHERE id = 3;COMMIT;",
        "comment": "Завершаем перевод средств на счетах Боба"
    },
    {
        "id": 1,
        "query": "SELECT amount FROM accounts WHERE id = 3;",
        "comment": "Аномалия несогласованное чтение (read skew): итоговая сумма получилась 1100, что больше чем на счетах Боба"
    },
    {
        "id": 1,
        "query": "COMMIT;"
    }
]