[
    {
        "id": 0,
        "query": "CREATE TABLE IF NOT EXISTS accounts(id integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, client text, amount numeric);TRUNCATE accounts;INSERT INTO accounts VALUES (2, 'bob', 200.00), (3, 'bob', 800.00);SELECT * FROM accounts;",
        "comment": "Инициализация таблиц и данных"
    },
    {
        "id": 0,
        "query": "BEGIN;UPDATE accounts SET amount = amount - 100 WHERE id = 3;",
        "comment": "Начинаем перевод средств с одного счета Боба на другой"
    },
    {
        "id": 1,
        "query": "BEGIN ISOLATION LEVEL REPEATABLE READ;UPDATE accounts SET amount = amount * 1.01 WHERE client IN (SELECT client FROM accounts GROUP BY client HAVING sum(amount) >= 1000);",
        "comment": "Другая транзакция начисляет проценты на все счета общим балансом, равным или превышающим 1000",
        "wait": 0
    },
    {
        "id": 0,
        "query": "COMMIT;"
    },
    {
        "id": 1,
        "query": "ROLLBACK;",
        "comment": "Получили ошибку сериализации и откатываемся"
    },
    {
        "id": 0,
        "query": "SELECT * FROM accounts;",
        "comment": "Транзакция завершилась, данные согласованны"
    }
]