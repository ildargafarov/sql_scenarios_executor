[
    {
        "id": 0,
        "query": "CREATE TABLE IF NOT EXISTS accounts(id integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, client text, amount numeric);TRUNCATE accounts;INSERT INTO accounts VALUES (2, 'bob', 0.00), (3, 'bob', 1000.00);SELECT * FROM accounts;",
        "comment": "Инициализация таблиц и данных"
    },
    {
        "id": 0,
        "query": "CREATE FUNCTION get_amount(id integer) RETURNS numeric AS $$ SELECT amount FROM accounts a WHERE a.id = get_amount.id; $$ VOLATILE LANGUAGE sql;",
        "comment": "VOLATILE функция"
    },
    {
        "id": 0,
        "query": "SELECT get_amount(id), pg_sleep(2) FROM accounts WHERE client = 'bob';",
        "comment": "Выводим счета Боба с задержкой",
        "wait": 0
    },
    {
        "id": 1,
        "query": "BEGIN;UPDATE accounts SET amount = amount + 100 WHERE id = 2;UPDATE accounts SET amount = amount - 100 WHERE id = 3;COMMIT;",
        "comment": "Переводим средства с одного счета Боба на другой"
    }
]