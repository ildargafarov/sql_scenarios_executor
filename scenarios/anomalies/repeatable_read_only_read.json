[
    {
        "id": 0,
        "query": "CREATE TABLE IF NOT EXISTS accounts(id integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, client text, amount numeric);TRUNCATE accounts;INSERT INTO accounts VALUES (1, 'alice', 1000.00), (2, 'bob', 900.00), (3, 'bob', 100.00);SELECT * FROM accounts;",
        "comment": "Инициализация таблиц и данных"
    },
    {
        "id": 0,
        "query": "BEGIN ISOLATION LEVEL REPEATABLE READ;UPDATE accounts SET amount = amount + (SELECT sum(amount) FROM accounts WHERE client = 'bob') * 0.01 WHERE id = 2;",
        "comment": "Первая транзакция начисляет проценты на один из счетов"
    },
    {
        "id": 0,
        "query": "SELECT * FROM accounts WHERE client = 'bob';",
        "comment": ""
    },
    {
        "id": 1,
        "query": "BEGIN ISOLATION LEVEL REPEATABLE READ;UPDATE accounts SET amount = amount - 100.0 WHERE id = 3;SELECT * FROM accounts WHERE client = 'bob';",
        "comment": "Вторая транзакция снимает средства с другого счета"
    },
    {
        "id": 1,
        "query": "COMMIT;",
        "comment": "Вторая транзакция фиксирует изменения"
    },
    {
        "id": 2,
        "query": "BEGIN ISOLATION LEVEL REPEATABLE READ;SELECT * FROM accounts WHERE client = 'alice';",
        "comment": "В этот момент начинается треться транзакция, которая пока просто читает не связанные с первыми двумя транзакциями счет"
    },
    {
        "id": 0,
        "query": "COMMIT;",
        "comment": "Фиксируется первая транзакция"
    },
    {
        "id": 2,
        "query": "SELECT * FROM accounts WHERE client = 'bob';",
        "comment": "Аномалия читающей транзакции"
    }
]