[
    {
        "id": 0,
        "query": "CREATE TABLE IF NOT EXISTS accounts(id integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, client text, amount numeric);TRUNCATE accounts;INSERT INTO accounts VALUES (2, 'bob', 200.00), (3, 'bob', 700.00);SELECT * FROM accounts;",
        "comment": "Инициализация таблиц и данных. Правило согласованности: допускаются отрицательные суммы на отдельных счетах, если общая сумма неотрицательна"
    },
    {
        "id": 0,
        "query": "BEGIN ISOLATION LEVEL REPEATABLE READ;SELECT sum(amount) FROM accounts WHERE client = 'bob';",
        "comment": "Первая транзакция выводит общую сумму на счетах"
    },
    {
        "id": 1,
        "query": "BEGIN ISOLATION LEVEL REPEATABLE READ;SELECT sum(amount) FROM accounts WHERE client = 'bob';",
        "comment": "Вторая транзакция выводит ту же сумму"
    },
    {
        "id": 0,
        "query": "UPDATE accounts SET amount = amount - 600.00 WHERE id = 2;",
        "comment": "Первая транзакция справедливо полагает, что может уменьшить сумму"
    },
    {
        "id": 1,
        "query": "UPDATE accounts SET amount = amount - 600.00 WHERE id = 3;COMMIT;",
        "comment": "Вторая транзакция приходит к такому же выводу. Но уменьшает другой счет"
    },
    {
        "id": 0,
        "query": "COMMIT;"
    },
    {
        "id": 0,
        "query": "SELECT * FROM accounts;",
        "comment": "Общий баланс отрицательный, хотя поодиночке каждая транзакция отработала корректно."
    }
]